#!/usr/bin/env python3

import logging
import argparse
import os
from src.core import *
from src.utils import *
from src.tasks import installer
from config import config


__version__    = "0.1"
__date__       = "10.05.2021"
__author__     = "Fabien Guillot"
__email__      = "fguillot@vectra.ai"
__description__= "AWS Pentest Lab Environment"



def main(args):
    
    if args.install:
        
        checkDistro()
        create_dir(config.BASE_INSTALL_PATH)
        whoami()
        checkPythonDefaultVersion()
        checkpythonMinVersion()
        #install_prereqs()
        
        if checkpyenv() is not True:
            
            print('installing pyenv for current user...')
            installPyenv()
            
        askSudoPassword()
        installer() 
            
    elif args.uninstall:
        
        print('Uninstall')
        
    else:
        
        print_error('No valide choice. Exiting...')
        exit()

if __name__ == '__main__':
        
    if not check_internet:
    
        print_error('An internet connection is required. Exiting...')
        exit()
    
    else:
        
        print_status('Internet connection OK')    
        
    
    parser = argparse.ArgumentParser(description='A set of tools for S3')
    parser.add_argument('-i', '--install', dest = "install", action = "store_true", default = False, help='Install the environement')
    parser.add_argument('-u', '--uninstall', dest = "uninstall", action = "store_true", default = False, help='Install the environement')
    parser.add_argument("-v", "--debug", dest="debug", action  = "store_true", default = False, help    = "Print debug information to the screen.")
     
        
    try:

        args = parser.parse_args()
        main(args)
        
    except Exception as e:
        logging.exception("Exception: {0!s}".format(e))
        exit(1)
  
    