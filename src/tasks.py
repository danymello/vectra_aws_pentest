from src.core import print_warning, print_status, print_status
from src.utils import *
from src.GitRepo import GitRepo
from src.PipModule import PipModule
from src.scriptedInstall import ScriptedInstall
import os
import time

def installer():
    '''
    install all modules
    '''
    
    print_status('Installing all modules')
    modules_dir = os.getcwd()+'/modules'
    #print(f'current dir: { modules_dir }')
    
    for filename in os.listdir(modules_dir):
            
        with open(os.path.join(modules_dir, filename), 'r') as f:  
                
            #read config file
            INSTALL_TYPE = parse_module_config_file(f,'INSTALL_TYPE')
                
            if INSTALL_TYPE == 'GIT':
                
                gitInstall = GitRepo()
                
                gitInstall.parse_config(f)
                
                if gitInstall.isPresent() == False:

                    gitInstall.clone()
                    gitInstall.create_venv()
                    gitInstall.install_reqs()
                    
            elif INSTALL_TYPE == 'PIP':
                    
                pipInstall = PipModule()
                
                pipInstall.parse_config(f)
                    
                if pipInstall.checkStatus() == False:
                    
                    pipInstall.install()
                    #pipInstall.checkStatus()
                
            elif INSTALL_TYPE == 'SCRIPTED':
                
                scriptInstall = ScriptedInstall()
                scriptInstall.parse_config(f)
                
                if scriptInstall.checkStatus() == False:
                    
                    scriptInstall.download()
                    scriptInstall.install()
                    scriptInstall.checkStatus()
                
            else:
                    
                print_error(f'Unknown type of module: { INSTALL_TYPE }')  
                
                
                
                
    
    