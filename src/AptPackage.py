import subprocess
from src.core import * 
import sys
import apt
import pkg_resources
from src.utils import run_command3, parse_module_config_file
import time

class AptPackage:
    
    def __init__(self):
        
        self.name = ''
        self.url = ''
        self.status = 'unknown'
        
    def printSummary(self):
        
        print(f'\n{ bcolors.CYAN }************************************************************{ bcolors.ENDC }')
        print(f'{ bcolors.BLUE }Name: { bcolors.ENDC }{ self.name }')
        print(f'{ bcolors.BLUE }Installation type: { bcolors.ENDC }APT')
        print(f'{ bcolors.BLUE }Project info: { bcolors.ENDC }{ self.url }')
        print(f'{ bcolors.CYAN }************************************************************{ bcolors.ENDC }\n')
        
        
    def parse_config(self, filename):
        '''
        parse config file
        '''
        
        self.name = parse_module_config_file(filename,'NAME')
        self.url = parse_module_config_file(filename,'URL')
        self.printSummary()        
    
    
    def install(self):
        '''
        install with apt
        '''
           
        print_status(f'Installing package: { self.name }')
        
        cli = 'sudo apt install '+self.name+' -y'
        print(f'subprocess for CLI: { cli }')
        run_command3(cli)
          
    def uninstall(self):
        '''
        uninstall with apt
        '''
        
        print_status(f'uninstalling package: { self.name }')
        
        cli = 'sudo apt remove '+self.name
        print(f'subprocess for CLI: { cli }')
        run_command3(cli)
    
    
    def checkStatus(self):
        '''
        check if the package is installed
        '''
        
        cache = apt.Cache()
        if cache['package-name'].is_installed:
            print_status(f'{ self.name } is installed')
            self.status = 'installed'
            return True
        else:
            print_warning(f'{ self.name } is NOT installed')
            self.status = 'not present'
            return False
        
        
        
        